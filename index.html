<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<title>OCR Demo</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
body {
  font-family: system-ui, sans-serif;
  max-width: 900px;
  margin: 40px auto;
}
.card {
  border: 1px solid #ddd;
  padding: 16px;
  border-radius: 8px;
  margin-bottom: 16px;
}
img {
  max-width: 100%;
  margin-top: 10px;
}
button {
  padding: 10px 16px;
  font-size: 14px;
}
pre {
  white-space: pre-wrap;
  background: #f7f7f7;
  padding: 10px;
}
</style>
</head>
<body>

<h1>OCR + Keyword Demo</h1>

<div class="card">
  <input type="file" id="imageInput" accept="image/*" />
  <br/><br/>
  <button id="ocrBtn">OCR</button>
  <p id="status"></p>
  <img id="preview" />
</div>

<div class="card">
  <h3>OCR Text</h3>
  <pre id="ocrText">(chưa có)</pre>
</div>

<div class="card">
  <h3>Keywords</h3>
  <ul id="keywords"></ul>
</div>

<script>
const API_URL = "http://EC2_PUBLIC_IP:8000/process-image";

const imgInput = document.getElementById("imageInput");
const preview = document.getElementById("preview");
const btn = document.getElementById("ocrBtn");
const status = document.getElementById("status");
const ocrText = document.getElementById("ocrText");
const keywords = document.getElementById("keywords");

imgInput.onchange = () => {
  const file = imgInput.files[0];
  if (file) preview.src = URL.createObjectURL(file);
};

btn.onclick = async () => {
  const file = imgInput.files[0];
  if (!file) {
    alert("Chọn ảnh trước");
    return;
  }

  const fd = new FormData();
  fd.append("image", file);

  status.textContent = "Đang OCR...";
  btn.disabled = true;

  try {
    const res = await fetch(API_URL, {
      method: "POST",
      body: fd
    });

    const data = await res.json();

    ocrText.textContent = data.ocr_text || "";
    keywords.innerHTML = "";

    (data.keywords || []).forEach((k, i) => {
      const li = document.createElement("li");
      const a = document.createElement("a");
      a.href = data.google_links[i];
      a.target = "_blank";
      a.textContent = k;
      li.appendChild(a);
      keywords.appendChild(li);
    });

    status.textContent = "✅ Xong";
  } catch (e) {
    status.textContent = "❌ Lỗi";
  } finally {
    btn.disabled = false;
  }
};
</script>

</body>
</html>
