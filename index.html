<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<title>OCR + Keyword Demo</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<style>
  body {
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    max-width: 900px;
    margin: 40px auto;
    padding: 0 16px;
  }
  h1 {
    text-align: center;
  }
  .card {
    border: 1px solid #ddd;
    border-radius: 8px;
    padding: 16px;
    margin-top: 16px;
  }
  button {
    padding: 10px 16px;
    font-size: 14px;
    border-radius: 6px;
    border: none;
    cursor: pointer;
  }
  button:disabled {
    opacity: 0.6;
    cursor: not-allowed;
  }
  img {
    max-width: 100%;
    margin-top: 12px;
    border-radius: 6px;
    border: 1px solid #eee;
  }
  pre {
    white-space: pre-wrap;
    background: #f7f7f7;
    padding: 12px;
    border-radius: 6px;
    min-height: 120px;
  }
</style>
</head>

<body>
<h1>OCR + Keyword Extractor</h1>

<div class="card">
  <input type="file" id="imageInput" accept="image/*" />
  <br><br>
  <button id="ocrBtn">OCR</button>
  <p id="status"></p>
  <img id="preview" />
</div>

<div class="card">
  <h3>OCR Text</h3>
  <pre id="ocrText">(ch∆∞a c√≥ d·ªØ li·ªáu)</pre>
</div>

<div class="card">
  <h3>Keywords</h3>
  <ul id="keywords"></ul>
</div>

<script>
  // üî¥ THAY IP N√ÄY B·∫∞NG PUBLIC IP EC2 C·ª¶A B·∫†N
  const API_URL = "http://EC2_PUBLIC_IP:8000/process-image";

  const imageInput = document.getElementById("imageInput");
  const preview = document.getElementById("preview");
  const btn = document.getElementById("ocrBtn");
  const statusEl = document.getElementById("status");
  const ocrTextEl = document.getElementById("ocrText");
  const keywordsEl = document.getElementById("keywords");

  imageInput.addEventListener("change", () => {
    const file = imageInput.files[0];
    if (file) {
      preview.src = URL.createObjectURL(file);
    }
  });

  btn.addEventListener("click", async () => {
    const file = imageInput.files[0];
    if (!file) {
      alert("H√£y ch·ªçn ·∫£nh tr∆∞·ªõc");
      return;
    }

    const formData = new FormData();
    formData.append("image", file);

    btn.disabled = true;
    statusEl.textContent = "ƒêang OCR...";
    ocrTextEl.textContent = "";
    keywordsEl.innerHTML = "";

    try {
      const res = await fetch(API_URL, {
        method: "POST",
        body: formData
      });

      if (!res.ok) {
        const t = await res.text();
        throw new Error(t);
      }

      const data = await res.json();

      ocrTextEl.textContent = data.ocr_text || "(Kh√¥ng c√≥ text)";
      (data.keywords || []).forEach((kw, i) => {
        const li = document.createElement("li");
        const a = document.createElement("a");
        a.href = data.google_links[i];
        a.target = "_blank";
        a.textContent = kw;
        li.appendChild(a);
        keywordsEl.appendChild(li);
      });

      statusEl.textContent = "‚úÖ Ho√†n th√†nh";
    } catch (err) {
      console.error(err);
      statusEl.textContent = "‚ùå L·ªói OCR";
      ocrTextEl.textContent = "(L·ªói)";
    } finally {
      btn.disabled = false;
    }
  });
</script>
</body>
</html>
